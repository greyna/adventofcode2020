use std::vec;

#[derive(PartialEq, Clone, Copy)]
enum Tile {
    Open,
    Tree,
}

impl Tile {
    fn parse(input: char) -> Self {
        match input {
            '.' => Tile::Open,
            '#' => Tile::Tree,
            _ => panic!("Unknown terrain"),
        }
    }
}

struct Map {
    pattern: Vec<Vec<Tile>>, // stored as [y][x] for coordinates (x, y)
    height: usize,
    pattern_width: usize,
}

impl Map {
    fn parse(input: &[&str]) -> Self {
        Map {
            pattern: input
                .iter()
                .map(|line| line.chars().map(Tile::parse).collect())
                .collect(),
            height: input.len(),
            pattern_width: input[0].len(),
        }
    }

    fn get_tile(&self, coord: (usize, usize)) -> Tile {
        // pattern is stored as [y][x] for coordinates (x, y)
        // infinite wrapping on x-axis
        self.pattern[coord.1][coord.0 % self.pattern_width]
    }

    fn count_tile_on_trajectory(&self, tile_type: Tile, slope: (usize, usize)) -> usize {
        (0..)
            .step_by(slope.0)
            .zip((0..).step_by(slope.1))
            .take_while(|(_, y)| *y < self.height)
            .map(|coord| self.get_tile(coord))
            .filter(|&tile| tile == tile_type)
            .count()
    }
}

fn main() {
    let input = get_input();
    let map = Map::parse(&input);
    println!(
        "\nParsed map of size ({}, {}).",
        map.pattern_width, map.height,
    );

    let slope_part1 = (3, 1);
    println!(
        "\nPart One: found {} trees on slope ({}, {}).",
        map.count_tile_on_trajectory(Tile::Tree, slope_part1),
        slope_part1.0,
        slope_part1.1
    );

    println!("\nPart Two:");
    let slopes_part2 = vec![(1, 1), (3, 1), (5, 1), (7, 1), (1, 2)];
    let tree_counts = slopes_part2
        .iter()
        .map(|&slope| map.count_tile_on_trajectory(Tile::Tree, slope));
    for (trees, slope) in tree_counts.clone().zip(&slopes_part2) {
        println!("Found {} trees on slope ({}, {}).", trees, slope.0, slope.1);
    }

    println!(
        "Product of all trees found = {}.",
        tree_counts.product::<usize>()
    )
}

pub fn get_input() -> Vec<&'static str> {
    vec![
        "........#..#.##.#..............",
        "...#...............#.#.........",
        "...#..#...#..##....#...........",
        "...#.............#....#.....#..",
        "..#......#..#...#.......#......",
        "..............##...............",
        "#.......#.........#......#....#",
        ".#.....###.....#...#.#.#...#...",
        "#.....................#....#.#.",
        ".......#...................#...",
        "...#.#...................#....#",
        "....#....#.......#...#.........",
        "..##.#............#..#.........",
        ".....##.#..............##..###.",
        "...........#....#....#.........",
        "#.....#...#...#.#.#.#.##.#...#.",
        ".#...............#....##.......",
        ".....#..#......#....#.......##.",
        ".....#........#.......#........",
        "...#...##...#..##...#.....##...",
        ".....#.........#.###...##...#..",
        ".#.##...#........#.#.#.#....#..",
        "....#......##.#...#.....#....#.",
        ".......###..........#..#..#....",
        "......#...#.##.................",
        "....#...#...#.........#......#.",
        ".....#...........#...###....#..",
        ".....#...#.#.#....##.#......#.#",
        "......#...#.....#..#..#........",
        "#......#..#...##........###....",
        "##.....#....##..#.#.###.#...#..",
        "........#....#.......#.....#..#",
        "#.#.#.##.#.#...................",
        "..#...##....#......#.....##....",
        ".......#.##..#........##..#....",
        ".#.#....##......#.#..........#.",
        "#..............#............#..",
        ".#.#.#.#.#.####.#.#...##.......",
        ".#..#.....##.#.......#.##...#..",
        "..#.#........#.............#.#.",
        "..#.#..........#..#........#...",
        "..#..#...#.......##...#.#....##",
        "...#.....#.#.#.....#....#....#.",
        ".#...#......#.....#..##........",
        "...#.......##.#.#.....#......#.",
        "...........#.....#.#.......#...",
        "#...........#...#..#.#........#",
        "....#......#..##........#..###.",
        ".#..#........................#.",
        "#.......#......#...#...#..#....",
        "....#.#...#..#.#....#....##.#..",
        ".....#......#..#..........##.#.",
        ".#.....#...........#.........#.",
        "...###.#...#.......#.#.........",
        ".......#....#..........#..#...#",
        "......##..#.......#...##.......",
        "..#..........#.......#.........",
        "..........#..#..#..#..#........",
        ".#.................####...#.#.#",
        "..##.....#............#........",
        "....#.....###...#......#....#.#",
        "...##.#...........#.##......#..",
        "#..##..#..#....#...#..#........",
        "......#....#........#.......#..",
        "......#.....#......###.........",
        ".#.....#.#......#.......#......",
        "..#.........#..#..#........##.#",
        "..#.#....#.....#....##....#.#..",
        "...#.............##............",
        "........#..#..#......#...#.....",
        ".....#.#...#...##.....#.....#..",
        ".#..#.#..........##...##.....#.",
        "......##.#..........#...#.....#",
        "#.#.##......#....#..........#..",
        "................#.......#.##...",
        "#.......#.....#.......#....#...",
        "#..#.....#.##..##...........#..",
        ".....#....#.#.##..........#..##",
        "#.......#.....#.##...........#.",
        "........#.##........###..#.#...",
        "........#..................#...",
        "#.........................#...#",
        "....#.........#...#.#..#.....#.",
        ".#............#....#...........",
        "..#.#...#..##...#.#.......#....",
        ".#.#....#...........#.........#",
        "...#.#..........#.....#...#....",
        "......#....#.#...............##",
        "....##......###...##.##.....##.",
        "............#.#....#.#.....#..#",
        ".....#..#.....#.#...###....#...",
        ".......##....##..#...##..#...##",
        ".....#.......##..#...#...#....#",
        "#.........##....#........###.#.",
        "...#..##...#...#.........#.#.#.",
        "....#.#.....#.....#............",
        "#........#....#..#........#....",
        ".......#....#...#..............",
        "#...#.........##.....###.#.....",
        ".#....##..#...#..##.........#..",
        "....#.....#......##..#..#....#.",
        "#.#..#.........#........#......",
        "..#.......#.........#.....###..",
        "..#..........#...........#....#",
        "..#...............#......#..#..",
        "....#..#...#....###.....#..#..#",
        "#...#...#..#...........#....#..",
        ".#....#.#..#....#.#...........#",
        ".....#.....#..#....#..#....#...",
        "#.#..#...........#.#...........",
        "..................#.#.......#..",
        "...#.........#.....#..##....#..",
        ".........#.#...#.........##....",
        "...#..#....#.....#...#..#......",
        ".#.##.....#....#....#......##..",
        "##..#.........#.#....#...#.....",
        "#......#.#...#....#.#..#.......",
        ".......#.....#.....###....#.#..",
        ".#....##.#.....#...#.......#...",
        ".#.......#..#...#......#..#..##",
        "...............#...#...........",
        "#..............#....#.#.#....#.",
        "...........#..#.......#.##..#..",
        "..#......#.#....#...#.#.....#..",
        "#..............................",
        "#..#....#..........#...#.......",
        "......#.............#####......",
        ".#...###......#.#.#.##..#......",
        "............#.##.....#.........",
        ".........#....##....#..........",
        "###....#......#.......#........",
        ".#.......##..........#..#....#.",
        "#..#.....................#....#",
        "........#...........#..........",
        "..#..........#...#..#.........#",
        "..#..#......##................#",
        ".....##..#...#..#..............",
        ".......#...##..#...............",
        ".......##..#.####....#....#.#..",
        "#.#..#..........#........##....",
        "....##....#.#..#....#.#...#....",
        "......#.......#...#.....#...#..",
        "..#..#...#.....#.......###.....",
        "...#.......#.#.#.......#.##....",
        "...............#..#.#........#.",
        ".#....###.#......#.............",
        ".#..#...#....#.#..#.....#......",
        ".......#.##....#.#.##.##...#.#.",
        "..#...#....#.#..##.#.....#...##",
        "..#...#......#...#......#...#..",
        "....#..#...#.#..#......#.......",
        "#..#...............#......#.##.",
        ".#....#...#..........#.#.....#.",
        ".#..#.#.#................#..#..",
        ".#....#.#...#..##.###..#...###.",
        "#.............#.....#.........#",
        "...#.........#...#.......#..#..",
        "......#..#.........#..........#",
        "........##................#..#.",
        "......#...#.#.....#......##....",
        "...............#...#....#......",
        "...#.#..#..#.....##.###..##..#.",
        ".#....##......#...#..##..#.....",
        ".....#.........##.##....#...#..",
        ".....#.#..................####.",
        "#.....#...#.............##....#",
        "#.#..........#...#..#..#.......",
        "#..#.#.........#...............",
        "....#...#.........#...##.......",
        "...........#.....#..##..#......",
        "#.....#.......#.#........#.....",
        "..##..#.....#...##......#......",
        "....#....#.....................",
        "............#......#.........##",
        ".....##.............#.....##..#",
        ".......#.............#..#.#.##.",
        ".###...#......#..#........##.#.",
        "..#.#...#.#....#.....#..#......",
        "..#.#..#.##........#...#.......",
        "........#.#...............#..#.",
        "........##.......#...#.......#.",
        "...#........##.#..........#.#.#",
        "..#..###.#.#.......#.#......#..",
        "....#..........#...#..#........",
        "...#..#...#...#.#....#...#..#..",
        "...#...#........#......##...#.#",
        "#...........#..........#..#.##.",
        "...#..##..................#.#..",
        "...##.#...#....#.#...#.####....",
        ".....#...#.#.#..#..............",
        ".....#..#.#.#..#...............",
        "..#..#..##...#.#..#.....##....#",
        ".......#.#..#.....#....#.......",
        "...#..#....#.........#...#.....",
        "..............#.#...#...##.....",
        "...................#...........",
        ".#......#.#...................#",
        ".##.....#........#.........#..#",
        ".##..##...#...................#",
        "...#....#.#..#.#.#..#.....##...",
        ".......#..#....#......####.#...",
        ".##..#..##....#.......#........",
        ".#...#...........##............",
        ".....#.....#........#..........",
        "....##..#....#.....#...........",
        ".#...#....................#....",
        "....#.........#.......##.....#.",
        ".#....#..#.....#.##....#.......",
        "....#..#.........#.#....#.#....",
        ".......#.........##....#.......",
        "..#......#....#....#...#.......",
        "........#..#.......#.##......#.",
        "..#.....#......#...#..#.......#",
        "#..#.....##...#...#............",
        ".......##.......#........#...#.",
        "..#......................#...#.",
        "....##.#.............#......#..",
        "#.#............................",
        "...##.#.....#.#............#.##",
        "......#...#..#.........##......",
        ".#.......#.....##.......#.#....",
        "...........#.#.........#..##...",
        "...#..........#.##....#........",
        "........#..#..#...#....#....#..",
        "........##....#.#....#........#",
        "..#........##....###....#......",
        "#................###...#...#...",
        "................#.#..###......#",
        "..#.....##.#................#..",
        ".....#...............#..#......",
        "..#.......####.....#..#.#....##",
        "..#.....#..#....#..............",
        "#.#...........#.#.....#..##....",
        "#.#..........#.......#...#.###.",
        "........#....#...#..#.#........",
        ".#.....#......#..#..#..###..#..",
        ".#.........#.##.#.#......##....",
        "..#.........#...##..#........#.",
        ".#...................#.........",
        "...#.#........#................",
        "............#.....#..##........",
        "..#.....#.#......#.......#...#.",
        "........#....##..##...#.....##.",
        ".#........#.#....#.#....#.#..#.",
        "#.#.......#....................",
        ".#..#...##.........#..#........",
        ".........#...............#.....",
        "...#...#.....#......#.......#..",
        "###......................#.#..#",
        "...#.....####........#..#.....#",
        "#.#...#.#...................##.",
        ".........#.....................",
        "#..........##..#.....#....#....",
        ".......#...#.#.##.#..##........",
        "..........#..#.#..#.#.......#.#",
        ".....................#.#...#...",
        "...........#.#........#.#.#....",
        ".......#......#........#...#.#.",
        ".........#....................#",
        ".##.##....#...#.#.#.#..........",
        "#....##..#.##....#....#.......#",
        ".##.#...#...............#....#.",
        ".......#...#.###....#..........",
        ".....#....#...#..#.............",
        "#.........#.##....#.#.#........",
        "..#...#.............##..#..#...",
        "#..##.......#..........#...#.#.",
        ".#..#.....#...........#......#.",
        "......#......#..............##.",
        ".#...#..#...#..####.....#.....#",
        "....##.......#..........##.....",
        ".#.....#.......#.....#.#...#...",
        "..#..#..#.#...#......#.........",
        "......#.#....#........#.......#",
        "........#.......#..............",
        "..#...#.#....#........#.......#",
        "............#....#...##.#......",
        ".........#.............#..#....",
        "#.............#.#..##.......#..",
        "#....#...........###....#......",
        "...#.....................#.....",
        "....#.#..........#...#.......#.",
        "......#..#.......#...#...#....#",
        ".#.#..#.....##.#........#......",
        "...........#...#.#.............",
        "...###............#...#..#.....",
        "..#.#.......#...#.#..#.........",
        ".#......##...........#.....#.##",
        ".....##.....#....##...##.#.#...",
        "..........#.#.#......#........#",
        "..#.#........#....##....#.#....",
        ".#....#...##...........#....#..",
        "##......#...#.......#..........",
        ".##...###..#...#......#..##.#.#",
        "...........##.#..##...#.......#",
        "..#..............##............",
        "........#..#........#...#..#.#.",
        "..#.............#......#...##..",
        "#...##....#...#....#....#.#....",
        ".#.#......#..##............#.#.",
        ".....###.#....##....#....#.....",
        "#.#.#..........#...#...#.#.#...",
        ".....#.#...........####........",
        ".....#....##...#.##..#......#..",
        "#....#.......#.##.......#..#...",
        ".....#.....#........#..........",
        ".......#.......#...#.##......#.",
        "...#.........##...#.#.#......##",
        "#........#........#...#..#.....",
        ".#......#.#......#.#...#....#..",
        "#..#....##.....##..............",
        "...#.##............#..........#",
        ".....#.#....#..#.#............#",
        "..#......#...###.##.......###..",
        "........#....#.#.#.#...........",
        "............#..#........#.....#",
        "....#...............#..........",
        "......#....#....###..#.......##",
        "#...#...##....#.........#...#..",
        "...........#.#.............#...",
        "...#..#.....#..##.#....#......#",
        "..#...#..#...#......#..........",
        "....#..#....#.......#........#.",
    ]
}
